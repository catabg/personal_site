---
import '../styles/global.css';

const { title = 'Catalina Brand Gómez - Comunicadora', description = 'Sitio personal de Catalina Brand Gómez' } = Astro.props;
---
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script is:inline>
      (() => {
        try {
          const savedTheme = localStorage.getItem('theme');
          const prefersLight = window.matchMedia('(prefers-color-scheme: light)').matches;
          const initialTheme = savedTheme || (prefersLight ? 'light' : 'dark');
          document.documentElement.setAttribute('data-theme', initialTheme);

          const savedLang = localStorage.getItem('lang');
          const browserLang = navigator.language?.toLowerCase().startsWith('es') ? 'es' : 'en';
          const initialLang = savedLang || browserLang;
          document.documentElement.setAttribute('data-lang', initialLang);
          document.documentElement.lang = initialLang;
        } catch {
          document.documentElement.setAttribute('data-theme', 'dark');
          document.documentElement.setAttribute('data-lang', 'es');
          document.documentElement.lang = 'es';
        }
      })();
    </script>
  </head>
  <body>
    <a class="skip-link" href="#content">
      <span class="i18n es">Saltar al contenido</span>
      <span class="i18n en">Skip to content</span>
    </a>
    <div class="page" id="top">
      <main id="content">
        <slot />
      </main>
      <footer class="site-footer">
        <div>© {new Date().getFullYear()} Catalina Brand Gómez</div>
        <div>
          <span class="i18n es">Sitio personal en construcción continua.</span>
          <span class="i18n en">Personal site in continuous development.</span>
        </div>
      </footer>
    </div>
    <script is:inline>
      (() => {
        const root = document.documentElement;
        const themeToggle = document.querySelector('[data-theme-toggle]');
        const themeLabel = document.querySelector('[data-theme-label]');
        const langButtons = document.querySelectorAll('[data-lang-set]');

        const themeLabels = {
          es: { light: 'Modo día', dark: 'Modo noche' },
          en: { light: 'Day mode', dark: 'Night mode' }
        };

        const getLang = () => root.getAttribute('data-lang') || 'es';

        const applyTheme = (theme) => {
          root.setAttribute('data-theme', theme);
          const lang = getLang();
          if (themeLabel) {
            themeLabel.textContent = themeLabels[lang][theme];
          }
          if (themeToggle) {
            themeToggle.setAttribute('aria-pressed', String(theme === 'light'));
          }
          try {
            localStorage.setItem('theme', theme);
          } catch {}
        };

        const applyLang = (lang) => {
          root.setAttribute('data-lang', lang);
          root.lang = lang;
          langButtons.forEach((button) => {
            const isActive = button.getAttribute('data-lang-set') === lang;
            button.setAttribute('aria-pressed', String(isActive));
            button.classList.toggle('is-active', isActive);
          });
          const activeTheme = root.getAttribute('data-theme') || 'dark';
          if (themeLabel) {
            themeLabel.textContent = themeLabels[lang][activeTheme];
          }
          try {
            localStorage.setItem('lang', lang);
          } catch {}
        };

        const currentTheme = root.getAttribute('data-theme') || 'dark';
        const currentLang = root.getAttribute('data-lang') || 'es';
        applyLang(currentLang);
        applyTheme(currentTheme);

        themeToggle?.addEventListener('click', () => {
          const activeTheme = root.getAttribute('data-theme') || 'dark';
          applyTheme(activeTheme === 'light' ? 'dark' : 'light');
        });

        langButtons.forEach((button) => {
          button.addEventListener('click', () => {
            const selectedLang = button.getAttribute('data-lang-set');
            if (!selectedLang) return;
            applyLang(selectedLang);
          });
        });
      })();
    </script>
  </body>
</html>
